<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>API测试页面</h1>
    <button id="testBtn">测试jQuery调用</button>
    <button id="testBtnFetch">测试Fetch调用</button>
    <div id="result"></div>

    <script>
        function request(url, method, data, headers) {
            return new Promise((resolve, reject) => {
                $.ajax({
                    url: url,
                    method: method,
                    data: data,
                    headers: headers,
                    success: resolve,
                    error: reject
                });
            });
        }

        $('#testBtn').click(async function() {
            $('#result').html('<p>正在请求...</p>');

            try {
                const result = await request(
                    'https://test1.tepc.cn/jetopcms/KS/sectionHandler.ashx',
                    'post',
                    {
                        "id": "017d373c-4f50-3467-7353-5d6747b282b8",
                        
                    },
                    {
                        "X-JetopDebug-User": "3FF0773D01A515D92C4AFFA3DD49EA88228E8C8E2D35E99AE116DE2413A8772A08061620225C1C2DBDF49D3CB79DAECACCBA4D1C97A726EF36FB0B0F2E739BD99A3C1B3B73B1CE5C36CD6967328C6F7AB2CD186B2F6A9FE112E0C79B3980ED7169BABDC39744AB7A2FF1FBAA5B415D04A28031072E874673B109343A9B630453C6AEE7780DB5D3946B08A2B40AE64F62ED2E9CC4CD787310"
                    }
                );

                $('#result').html(`
                    <h3>jQuery成功！</h3>
                    <div><strong>姓名:</strong> ${result.XingMing || '未找到'}</div>
                    <div><strong>岗位:</strong> ${result.GangWei || '未找到'}</div>
                    <div><strong>工号:</strong> ${result.GongHao || '未找到'}</div>
                    <div><strong>年份:</strong> ${result.NianFen || '未找到'}</div>
                    <div><strong>毕业学校:</strong> ${result.BiYeYX || '未找到'}</div>
                    <hr>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `);
                console.log('jQuery Response (formatted JSON):', JSON.stringify(result, null, 2));
                console.log('jQuery Response (object):', result);
                console.log('Key fields check:', {
                    XingMing: result.XingMing,
                    GangWei: result.GangWei,
                    GongHao: result.GongHao,
                    NianFen: result.NianFen,
                    BiYeYX: result.BiYeYX
                });

            } catch (error) {
                $('#result').html(`
                    <h3>jQuery错误！</h3>
                    <p>错误信息: ${error.responseText || error.message}</p>
                    <p>状态码: ${error.status}</p>
                    <pre>${JSON.stringify(error, null, 2)}</pre>
                `);
                console.error('jQuery API Error:', error);
            }
        });

        $('#testBtnFetch').click(async function() {
            $('#result').html('<p>Fetch请求中...</p>');

            try {
                const requestBody = {
                    "id": "017d373c-4f50-3467-7353-5d6747b282b8"
                };

                const formData = new URLSearchParams();
                formData.append('id', requestBody.id);

                console.log('Fetch Form data:', formData.toString());

                const response = await fetch('https://test1.tepc.cn/jetopcms/KS/sectionHandler.ashx', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
                        'X-JetopDebug-User': '3FF0773D01A515D92C4AFFA3DD49EA88228E8C8E2D35E99AE116DE2413A8772A08061620225C1C2DBDF49D3CB79DAECACCBA4D1C97A726EF36FB0B0F2E739BD99A3C1B3B73B1CE5C36CD6967328C6F7AB2CD186B2F6A9FE112E0C79B3980ED7169BABDC39744AB7A2FF1FBAA5B415D04A28031072E874673B109343A9B630453C6AEE7780DB5D3946B08A2B40AE64F62ED2E9CC4CD787310',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: formData.toString()
                });

                console.log('Fetch Response status:', response.status);
                console.log('Fetch Response headers:', Object.fromEntries(response.headers.entries()));

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status}, body: ${errorText}`);
                }

                const responseText = await response.text();
                console.log('Fetch Raw response:', responseText);

                let result;
                try {
                    result = JSON.parse(responseText);
                    console.log('Parsed result:', result);
                    console.log('Result type:', typeof result);
                    console.log('Is Array:', Array.isArray(result));

                    // 如果返回的是数组，取第一个元素
                    if (Array.isArray(result) && result.length > 0) {
                        console.log('Taking first element from array');
                        result = result[0];
                        console.log('Result after taking first element:', result);
                    }
                } catch (e) {
                    result = responseText;
                }

                $('#result').html(`
                    <h3>Fetch成功！</h3>
                    <div><strong>姓名:</strong> ${result.XingMing || '未找到'}</div>
                    <div><strong>岗位:</strong> ${result.GangWei || '未找到'}</div>
                    <div><strong>工号:</strong> ${result.GongHao || '未找到'}</div>
                    <div><strong>年份:</strong> ${result.NianFen || '未找到'}</div>
                    <div><strong>毕业学校:</strong> ${result.BiYeYX || '未找到'}</div>
                    <hr>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `);
                console.log('Fetch Response (formatted JSON):', JSON.stringify(result, null, 2));
                console.log('Fetch Response (object):', result);
                console.log('Key fields check:', {
                    XingMing: result.XingMing,
                    GangWei: result.GangWei,
                    GongHao: result.GongHao,
                    NianFen: result.NianFen,
                    BiYeYX: result.BiYeYX
                });

            } catch (error) {
                $('#result').html(`
                    <h3>Fetch错误！</h3>
                    <p>错误信息: ${error.message}</p>
                `);
                console.error('Fetch API Error:', error);
            }
        });
    </script>
</body>
</html>